import{_ as z}from"./index.vue_vue_type_script_setup_true_lang-3fe19e5f.js";import{d as H,r as x,w as q,o as L,a as k,b as D,e as a,c as U,t as m,u as h,f as y,m as w,z as _,B as $,q as C,x as b}from"./index-181d502b.js";import{b as X}from"./mjDraw-4b87b82b.js";const Y=H({__name:"index",props:{src:String,selectColor:String,maxSteps:Number,updateFileInfo:Function},setup(A,{expose:I}){const p=A,n=x(null),s=x(null);let f=new Set;const i=x([]),B=x(10);q(()=>p.maxSteps,e=>{e&&(B.value=e)},{immediate:!0}),L(()=>{n.value&&(s.value=n.value.getContext("2d",{willReadFrequently:!0}),v())}),q(()=>p.src,e=>{e&&v()});function v(){if(!s.value||!p.src)return;const e=new Image;e.crossOrigin="anonymous",e.onload=()=>{var t;n.value.width=e.width,n.value.height=e.height,(t=p.updateFileInfo)==null||t.call(p,{width:e.width,height:e.height,scaleRatio:1}),s.value.drawImage(e,0,0,e.width,e.height)},e.src=p.src}function S(e,t){return(t*n.value.width+e)*4}function R(e,t,u){const l=S(e,t);return[u[l],u[l+1],u[l+2],u[l+3]]}function j(e,t){return e.reduce((l,g,d)=>l+Math.abs(g-t[d]),0)}function F(e,t,u,l,g){if(s.value&&n.value){const r=s.value.getImageData(0,0,n.value.width,n.value.height);c(r)}const d=[[e,t]];for(;d.length;){const[r,o]=d.shift();if(r<0||r>=n.value.width||o<0||o>=n.value.height)continue;const W=R(r,o,g);if(j(W,l)>50||j(W,u)===0)continue;const O=S(r,o);g.set(u,O),f.add(r+","+o),d.push([r+1,o]),d.push([r-1,o]),d.push([r,o+1]),d.push([r,o-1])}}function E(e){if(!s.value||!n.value)return;const t=e.offsetX,u=e.offsetY,l=s.value.getImageData(0,0,n.value.width,n.value.height),g=R(t,u,l.data),d=M(p.selectColor);F(t,u,d,g,l.data),s.value.putImageData(l,0,0)}function T(){if(!s.value||!n.value)return"";const e=s.value.getImageData(0,0,n.value.width,n.value.height),t=new Uint8ClampedArray(e.data);for(let d=0;d<n.value.height;d++)for(let r=0;r<n.value.width;r++){const o=S(r,d);f.has(r+","+d)?(t[o]=255,t[o+1]=255,t[o+2]=255):(t[o]=0,t[o+1]=0,t[o+2]=0),t[o+3]=255}const u=new ImageData(t,n.value.width,n.value.height),l=document.createElement("canvas");return l.width=n.value.width,l.height=n.value.height,l.getContext("2d").putImageData(u,0,0),l.toDataURL("image/png")}function M(e){if(e&&e.startsWith("#")){const t=e.length===4?"#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]:e,u=parseInt(t.slice(1,3),16),l=parseInt(t.slice(3,5),16),g=parseInt(t.slice(5,7),16);return[u,l,g,255]}else if(e&&e.startsWith("rgb")){const t=e.replace(/rgba?\(/,"").replace(/\)/,"").split(",").map(u=>parseInt(u));return t.length===3&&t.push(255),t}return[0,0,0,255]}async function N(){return await T()}function P(){if(i.value.length===0||!s.value||!n.value)return;const e=i.value.pop();s.value.putImageData(e.imageData,0,0),f=new Set(e.currentModifiedPixels)}function V(){!s.value||!n.value||(s.value.clearRect(0,0,n.value.width,n.value.height),f.clear(),i.value=[],v())}function c(e){const t=new Set(f);i.value.push({imageData:e,currentModifiedPixels:t}),i.value.length>B.value&&i.value.shift()}return I({getBase:N,undo:P,clear:V}),(e,t)=>(k(),D("div",null,[a("canvas",{ref_key:"canvas",ref:n,onClick:E,crossOrigin:"anonymous"},null,512)]))}});const G={class:"w-full h-full bg-gray-100"},J={class:"h-[80px] w-full flex justify-center items-center space-x-5"},K={class:"text-2xl font-bold"},Q={key:0,class:"bg-gray-100 flex-1 h-full w-full flex"},Z={class:"w-[50%] flex flex-col border-r"},ee=a("span",{class:"text-2xl w-full text-center"},"操作区域",-1),te={class:"border-b border-t h-[50px] flex justify-center items-center space-x-5"},ae={class:"mt-10 ml-10"},ne={class:"w-[50%] flex flex-col"},se=a("span",{class:"text-2xl w-full text-center"},"预览区域",-1),le={class:"border-b border-t h-[50px] flex justify-center items-center space-x-5"},ie={class:"border-b border-t h-[50px] flex justify-center items-center space-x-5"},ce=a("span",null,"图片原始信息：",-1),ue=["src"],oe={key:1,class:"bg-gray-100 flex-1 h-full w-full flex"},re={class:"w-[50%] flex flex-col border-r"},de=a("span",{class:"text-2xl w-full text-center"},"操作区域",-1),fe={class:"border-b border-t h-[50px] flex justify-center items-center space-x-5"},he={class:"mt-10 ml-10"},ve={class:"w-[50%] flex flex-col"},pe=a("span",{class:"text-2xl w-full text-center"},"预览区域",-1),me={class:"border-b border-t h-[50px] flex justify-center items-center space-x-5"},_e={class:"border-b border-t h-[50px] flex justify-center items-center space-x-5"},xe=a("span",null,"图片原始信息：",-1),ge=["src"],ke=H({__name:"index",setup(A){const I=x(""),p="http://nineai-v1.oss-cn-shanghai.aliyuncs.com/ai/thumb-mj-%5B1314%5D-96a0a55d-5.png",n="http://nineai-v1.oss-cn-shanghai.aliyuncs.com/ai/thumb-mj-%5B1314%5D-96a0a55d-5.png",s=x(null),f=x(""),i=x(1),B=x(!1),v=x({}),S=U(()=>i.value===1?"模块选区":"自由绘制"),R=U(()=>i.value===2?"模块选区模式":"自由绘制模式");async function j(){var e;const c=await((e=s.value)==null?void 0:e.getBase());I.value=c}async function F(){const c=i.value===1?p:n,t=`data:image/png;base64,${(await X({url:c})).data}`;f.value=t}const E=U(()=>B.value?"橡皮擦模式":"画笔模式");function T(){f.value=null,i.value=i.value===1?2:1}q(i,()=>{F()},{immediate:!0});function M(){var c;(c=s.value)==null||c.undo()}function N(){var c;(c=s.value)==null||c.clear()}function P(c){v.value=c}function V(){var c;(c=s.value)==null||c.toggleEraser(),B.value=!B.value}return(c,e)=>(k(),D("div",G,[a("div",J,[a("span",K," 当前测试模式："+m(h(R)),1),y(h(b),{type:"primary",onClick:T},{default:w(()=>[_(" 切换至"+m(h(S))+"模式 ",1)]),_:1})]),i.value===1?(k(),D("div",Q,[a("div",Z,[ee,a("div",te,[y(h(b),{type:"primary",onClick:M},{default:w(()=>[_(" 返回上一步 ")]),_:1}),y(h(b),{type:"primary",onClick:N},{default:w(()=>[_(" 清空画布 ")]),_:1}),y(h(b),{type:"primary",onClick:V},{default:w(()=>[_(" 切换橡皮擦模式 ")]),_:1}),_(" 当前模式: "+m(h(E)),1)]),a("div",ae,[a("div",null,[f.value&&i.value===1?(k(),$(z,{key:0,ref_key:"canvasRef",ref:s,"update-file-info":P,max:300,src:f.value},null,8,["src"])):C("",!0)])])]),a("div",ne,[se,a("div",le,[y(h(b),{type:"primary",onClick:j},{default:w(()=>[_(" 获取蒙层 ")]),_:1})]),a("div",ie,[ce,a("span",null,"宽度： "+m(v.value.width),1),a("span",null,"高度： "+m(v.value.height),1),a("span",null,"缩放比： "+m(v.value.scaleRatio),1)]),a("div",null,[I.value?(k(),D("img",{key:0,src:I.value,alt:""},null,8,ue)):C("",!0)])])])):C("",!0),i.value===2?(k(),D("div",oe,[a("div",re,[de,a("div",fe,[y(h(b),{type:"primary",onClick:M},{default:w(()=>[_(" 返回上一步 ")]),_:1}),y(h(b),{type:"primary",onClick:N},{default:w(()=>[_(" 清空画布 ")]),_:1}),_(" 当前模式: "+m(h(E)),1)]),a("div",he,[a("div",null,[f.value&&i.value===2?(k(),$(Y,{key:0,ref_key:"canvasRef",ref:s,"select-color":"#fff","update-file-info":P,max:500,src:f.value},null,8,["src"])):C("",!0)])])]),a("div",ve,[pe,a("div",me,[y(h(b),{type:"primary",onClick:j},{default:w(()=>[_(" 获取蒙层 ")]),_:1})]),a("div",_e,[xe,a("span",null,"宽度： "+m(v.value.width),1),a("span",null,"高度： "+m(v.value.height),1),a("span",null,"缩放比： "+m(v.value.scaleRatio),1)]),a("div",null,[I.value?(k(),D("img",{key:0,src:I.value,alt:""},null,8,ge)):C("",!0)])])])):C("",!0)]))}});export{ke as default};
