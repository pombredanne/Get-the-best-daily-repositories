import{d as j,k as ee,r as i,a as c,b as m,G as te,H as se,f as v,u as n,I as oe,J as w,n as R,e as r,_ as k,q as x,K as re,i as ae,M as ne,l as le,c as L,w as U,o as ie,O as ce,F as de,p as ue,t as he,B,m as f,P,Q as M,R as pe,S as ge}from"./index-181d502b.js";import{c as fe}from"./index-c94da121.js";function ve(a,u){let s,l;return function(...p){l=p,s||(s=setTimeout(()=>{a.apply(this,l),s=null},u))}}const me="/assets/loadErr-b42c97c5.png",we={class:"w-[300px]"},xe=["src"],_e=j({__name:"loadImg",props:{id:null,url:null,width:null,height:null,preurl:null},setup(a){const u=ee(),s=i(!1),l=i("loading");function _(){s.value=!0,l.value="success"}function p(){s.value=!0,l.value="error"}return(I,h)=>(c(),m("div",we,[te(v(n(oe),{width:a.width,src:a.url,"on-load":_,"on-error":p,"preview-src":a.preurl},null,8,["width","src","preview-src"]),[[se,s.value&&l.value==="success"]]),s.value?x("",!0):(c(),m("div",{key:0,style:w({width:`${a.width}px`,height:`${a.height}px`}),class:R(["relative",n(u).theme==="dark"?"loadBg-dark":"loadBg-light"])},[r("span",{style:w({left:`${a.width-37}px`}),class:"absolute top-2 bg-white dark:bg-[#22252a] rounded-full p-[2px]"},[v(n(k),{icon:"line-md:loading-alt-loop",class:"text-[24px] text-primary"})],4)],6)),s.value&&l.value==="error"?(c(),m("div",{key:1,style:w({width:`${a.width}px`,height:`${a.height}px`}),class:R(["relative flex justify-center items-center",n(u).theme==="dark"?"loadBg-dark":"loadBg-light"])},[r("img",{src:n(me),alt:""},null,8,xe)],6)):x("",!0)]))}});const ye=re(_e,[["__scopeId","data-v-e4d72a71"]]),be={class:"min-h-full overflow-hidden flex flex-col"},ke={class:"flex-1 min-h-full p-2 relative"},Ie=["id"],$e={class:"menu p-2 text-[#cbd5e1]"},Ce={class:"prompt"},Le={class:"flex justify-end items-end space-x-2"},Be=["onClick"],Pe={class:"text-sm dark:text-slate-400"},Me=r("span",null,"画同款",-1),Ee=["onClick"],Se={class:"text-sm dark:text-slate-400"},We=r("span",null,"使用当前画同款",-1),De=["onClick"],He={class:"text-sm dark:text-slate-400"},Ne=r("span",null,"复制提示词",-1),Re=r("div",{id:"footer",class:"w-full absolute bottom-[350px]"},null,-1),ze=j({__name:"index",props:{dataList:null,scaleWidth:null,isDrawLike:{type:Boolean},usePropmpt:{type:Boolean},copyPropmpt:{type:Boolean},gap:{default:5},preOrigin:{type:Boolean}},emits:["loadMore","usePropmptDraw"],setup(a,{emit:u}){var W;const s=a,l=ae();(W=ne())==null||W.appContext.config.globalProperties.$viewerApi;const _=le(),p=i({}),I=i(0),h=i(160),g=i(0);i([]);const $=i(null),E=i(0),z=L(()=>l.isLogin),S=L(()=>s.scaleWidth?Number(s.scaleWidth)*2+s.gap+150:150),A=pe();function O(){V(),F();const t=g.value,o=h.value,e=[];s.dataList.forEach((d,C)=>{const{width:Q,height:X}=d,Y=o/Q,D=X*Y+s.gap+I.value,b=p.value[d.id];if(e.length<t)b.style.top="0px",b.style.left=`${(o+s.gap)*C}px`,e.push(D);else{const H=Math.min.apply(null,e),N=e.findIndex(Z=>Z===H);b.style.top=`${H+0}px`,b.style.left=`${N*(h.value+s.gap)}px`,e[N]+=D}}),E.value=Math.max(...e)+100}function T(t,o){t&&o&&(p.value[o.id]=t)}function V(){const{showName:t=0,showOther:o=0}={};I.value=[t,o].filter(e=>e).length*15}U(()=>s.scaleWidth,t=>{y()}),U(()=>s.dataList,t=>{t&&ge(()=>{y()})},{immediate:!0});function F(){if(!$.value)return;const t=$.value.clientWidth;g.value=Math.floor(t/S.value);const o=t-g.value*S.value,e=(g.value-1)*s.gap;o-e<0&&(g.value-=1),h.value=Math.floor((t-e)/g.value)}function q(t){if(!z.value)return l.setLoginDialog(!0);const{prompt:o}=t;fe({text:o}),_.success("复制prompt成功")}function G(t){A.push(`/painting?drawId=${t.id}`)}function J(t){const{prompt:o}=t;u("usePropmptDraw",o)}const K=L(()=>t=>{const{width:o,height:e}=t;return e/(o/h.value)}),y=ve(function(){O()},200);return ie(async()=>{window.addEventListener("resize",y);const t=document.getElementById("footer");new IntersectionObserver((e,d)=>{e.forEach(C=>{C.isIntersecting&&u("loadMore")})}).observe(t)}),ce(()=>{window.removeEventListener("resize",y)}),(t,o)=>(c(),m("div",be,[r("div",ke,[r("div",{id:"wapper",ref_key:"wapperRef",ref:$,class:"wapper",style:w({height:`${E.value}px`})},[(c(!0),m(de,null,ue(a.dataList,e=>(c(),m("div",{id:e.id,key:e.prompt,ref_for:!0,ref:d=>T(d,e),class:"wapper-item",style:w({width:`${h.value}px`})},[v(ye,{preUrl:e.originalImgUrl,id:e.id,url:e.thumb||e.originalImgUrl,width:h.value,height:n(K)(e),preurl:e.originalImgUrl},null,8,["preUrl","id","url","width","height","preurl"]),r("div",$e,[r("div",Ce,he(e.fullPrompt),1),r("div",Le,[a.isDrawLike?(c(),B(n(M),{key:0,trigger:"hover"},{trigger:f(()=>[r("button",{class:"flex h-5 w-8 items-center justify-center rounded border transition hover:bg-[#666161] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:P(d=>G(e),["stop"])},[r("span",Pe,[v(n(k),{icon:"fluent:draw-image-24-regular",class:"text-sm"})])],8,Be)]),default:f(()=>[Me]),_:2},1024)):x("",!0),a.usePropmpt?(c(),B(n(M),{key:1,trigger:"hover"},{trigger:f(()=>[r("button",{class:"flex h-5 w-8 items-center justify-center rounded border transition hover:bg-[#666161] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:P(d=>J(e),["stop"])},[r("span",Se,[v(n(k),{icon:"fluent:draw-image-24-regular",class:"text-sm"})])],8,Ee)]),default:f(()=>[We]),_:2},1024)):x("",!0),a.copyPropmpt?(c(),B(n(M),{key:2,trigger:"hover"},{trigger:f(()=>[r("button",{class:"flex h-5 w-8 items-center justify-center rounded border transition hover:bg-[#666161] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:P(d=>q(e),["stop"])},[r("span",He,[v(n(k),{icon:"tabler:copy",class:"text-sm"})])],8,De)]),default:f(()=>[Ne]),_:2},1024)):x("",!0)])])],12,Ie))),128)),Re],4)])]))}});export{ze as _};
